<ng-container [ngSwitch]="loadingStudentData">
  <cp-spinner *ngSwitchCase="true"></cp-spinner>

  <div class="page" *ngSwitchCase="false">
    <div class="cp-wrapper cp-wrapper--outer">
      <div class="row">
        <div class="col-xs-8 col-xs-offset-2">
          <cp-profile-header
            (message)="launchMessageModal()">
          </cp-profile-header>
        </div>
      </div>
    </div>

    <div class="cp-wrapper cp-wrapper--outer">
      <div class="row">
        <div class="col-xs-8 col-xs-offset-2">
          <cp-profile-top-bar
            (download)="onDownload()"
            (filter)="onFilter($event)">
          </cp-profile-top-bar>
        </div>
      </div>
    </div>

    <ng-container [ngSwitch]="loadingEngagementData">
      <cp-spinner *ngSwitchCase="true"></cp-spinner>

      <ng-container *ngSwitchCase="false" class="feed">
        <div class="cp-wrapper cp-wrapper--outer">
          <div class="row">
            <div class="col-xs-8 col-xs-offset-2">
              <div class="feed__wrapper">
                <ng-container
                  class="feed__item"
                  *ngFor="let day of engagementsByDay">
                  <div class="feed__header">
                    <div class="row">
                      <div class="col-xs-12">
                        <div class="feed__header__bg">
                            <p>{{ day | cpDatePipe:dateFormat }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="feed__body">
                    <div class="row">
                      <div class="col-xs-12">
                        <div class="feed__body__wrapper engagement">
                          <ng-container *ngFor="let engagement of engagementData[day]">
                            <div class="row engagement__item">
                              <div class="col-xs-2">
                                <p class="engagement__time">
                                  <strong>{{ engagement.epoch_time | cpDatePipe:timeFormat }}</strong>
                                </p>
                              </div>
                              <div class="col-xs-10 engagement__meta no-left-padding">
                                <p class="engagement__meta__title">
                                  <strong>{{ engagement.title }}</strong>
                                </p>

                                <p class="text-muted engagement__meta__type">
                                  <span class="icon">
                                    <i class="material-icons">{{ engagement.is_event ? 'event' : 'info_outline' }}</i>
                                  </span>
                                  {{ engagement.is_event ? 'Event' : 'Service' }}
                                </p>
                                <div class="engagement__rating">
                                  <cp-stars
                                    [size]="starSize"
                                    [maxRate]="engagement.rating_scale_maximum"
                                    [avgRate]="engagement.avg_rating_percent">
                                  </cp-stars>
                                </div>
                                <p class="engagement__feedback">{{ engagement.feedback_text }}</p>
                              </div>
                            </div>
                          </ng-container>
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-xs-12">
            <cp-pagination
              [pageNext]="pageNext"
              [pagePrev]="pagePrev"
              [pageNumber]="pageNumber"
              (next)="onPaginationNext()"
              (previous)="onPaginationPrevious()">
            </cp-pagination>
          </div>
        </div>
      </ng-container>
    </ng-container>
  </div>
</ng-container>

<cp-modal
  *ngIf="isStudentComposeModal"
  modalId="studentsComposeModal">
  <cp-students-compose
    [props]="messageData"
    (success)="onFlashMessage()"
    (teardown)="onComposeTeardown()">
  </cp-students-compose>
</cp-modal>
