<div [ngSwitch]="loading">
  <cp-spinner *ngSwitchCase="true"></cp-spinner>

  <div *ngSwitchCase="false">
    <div class="row margin-bottom">
      <form [formGroup]="form">
        <div class="col-xs-6">
          <div class="cp-card">
            <div class="row">
              <div class="col-xs-12">
                <p class="title" i18n>{{ 'services_label_banner' | cpI18n }}</p>
                <div class="margin-top row">
                  <cp-image-upload
                    description="Upload a picture for your service"
                    [defaultImage]="form.controls['logo_url'].value"
                    [required]="formError && form.controls['logo_url'].hasError('required')"
                    (uploaded)="form.controls.logo_url.setValue($event)">
                  </cp-image-upload>
                </div>
              </div>
            </div>

            <div class="row margin-top">
              <div class="col-xs-12">
                <p class="title" i18n>{{ 'services_label_details' | cpI18n }}</p>
                <div class="form-group margin-top">
                  <label i18n>{{ 'services_label_name' | cpI18n }}</label>
                  <input
                    type="text"
                    class="form-control"
                    formControlName="name"
                    placeholder="Add a short, clear name"
                    [class.error]="formError && form.controls['name'].hasError('required')">
                </div>

                <div class="row form-group">
                  <div class="col-xs-6">
                    <label i18n>{{ 'select_category' | cpI18n }}</label>
                    <cp-dropdown
                      [items]="categories"
                      [selectedItem]="selectedCategory"
                      (selected)="onCategoryUpdate($event)"
                      [isRequiredError]="formError && form.controls['category'].hasError('required')">
                    </cp-dropdown>
                  </div>
                </div>

                <div class="row form-group">
                  <div class="col-xs-6">
                    <label i18n>{{ 'phone_number' | cpI18n }}</label>
                    <input
                      type="text"
                      class="form-control"
                      formControlName="contactphone">
                  </div>
                </div>

                <div class="row form-group">
                  <div class="col-xs-6">
                    <label i18n>{{ 'email' | cpI18n }}</label>
                    <input
                      type="email"
                      class="form-control"
                      formControlName="email">
                  </div>
                </div>

                <div class="row form-group">
                  <div class="col-xs-6">
                    <label i18n>{{ 'website' | cpI18n }}</label>
                    <input
                      type="text"
                      class="form-control"
                      formControlName="website">
                  </div>
                </div>

                <div class="form-group form-group">
                  <label i18n>{{ 'services_label_description' | cpI18n }} ({{ 'optional' | cpI18n }})</label>
                  <textarea
                    formControlName="description"
                    placeholder="Tell people more about the event">
                  </textarea>
                </div>

                <div class="row">
                  <div class="col-xs-12">
                    <label i18n>{{ 'location' | cpI18n }} (({{ 'optional' | cpI18n }}))</label>
                    <div class="row form-group">
                      <div class="col-xs-12">
                        <cp-place-autocomplete
                          [defaultValue]="form.controls.address.value"
                          (placeChange)="onPlaceChanged($event)">
                        </cp-place-autocomplete>
                      </div>
                    </div>
                    <div class="row form-group">
                      <div class="col-xs-6">
                        <input
                          type="text"
                          class="form-control"
                          placeholder="Building"
                          formControlName="location">
                      </div>

                      <div class="col-xs-6">
                        <div class="form-group">
                          <input
                            type="text"
                            class="form-control"
                            placeholder="Room"
                            formControlName="room_data">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row form-group">
                  <div class="col-xs-12">
                    <div class="maps">
                      <cp-maps [center]="mapCenter"></cp-maps>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xs-6">
          <div class="cp-card">
            <div class="row">
              <div class="col-xs-8">
                <p class="title" i18n>{{ 'services_label_service_attendance' | cpI18n }}</p>
              </div>
              <div class="col-xs-4 pull-right">
                <span class="pull-right">
                  <cp-switch
                    [id]="attendance"
                    (toggle)="onToggleAttendance($event)"
                    [isChecked]="form.controls.service_attendance.value">
                  </cp-switch>
                </span>
              </div>
            </div>

            <ng-container *ngIf="form.controls.service_attendance.value">
              <fieldset disabled>
                <div class="row">
                  <div class="col-xs-6">
                    <label i18n>{{ 'services_label_enable_service_feedback' | cpI18n }}</label>
                    <cp-dropdown [items]="serviceFeedback"></cp-dropdown>
                  </div>
                </div>
              </fieldset>
              <div formArrayName="providers" class="providers-list">
                <div
                  class="row form-box"
                  *ngFor="let provider of form.controls.providers.controls; let i=index">
                  <div [formGroupName]="i" class="col-xs-12">
                    <div class="cp-card cp-card--alt cp-card--half-padding cp-card--no-shadow">
                      <div class="delete-provider">
                        <button
                          (click)="delteProviderControl(i)"
                          class="cpbtn cpbtn--link-dark">
                          &times;
                        </button>
                      </div>
                      <div class="row form-group">
                        <div class="col-xs-6">
                          <label i18n>{{ 'name' | cpI18n }}</label>
                          <input
                            type="text"
                            placeholder="Name"
                            formControlName="provider_name"
                            [class.error]="formError && form.controls.service_attendance.value && provider.controls['provider_name'].hasError('required')">
                        </div>
                        <div class="col-xs-6">
                          <label i18n>{{ 'email' | cpI18n }}</label>
                          <input
                            type="email"
                            placeholder="Email"
                            formControlName="email"
                            [class.error]="formError && form.controls.service_attendance.value && provider.controls['email'].hasError('required')">
                        </div>
                      </div>

                      <div class="row form-group">
                        <div class="col-xs-12">
                          <label i18n>{{ 'services_label_default_question' | cpI18n }}</label>
                          <input
                            type="text"
                            formControlName="custom_basic_feedback_label"
                            [class.error]="formError && form.controls.service_attendance.value && provider.controls['custom_basic_feedback_label'].hasError('required')">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
        </div>
      </form>
    </div>

    <div class="form-footer">
      <div class="cp-wrapper cp-wrapper--outer">
        <div class="col-xs-12">
          <div class="row">
            <div class="col-xs-12">
              <div class="text-right">
                <label class="error" *ngIf="formError" i18n>
                    <span>&#x26A0;</span> {{ 'error_fill_out_marked_fields' | cpI18n }}
                </label>
                <a [routerLink]="['/manage/services']"
                  class="cpbtn cpbtn--cancel" i18n>
                  {{ 'cancel' | cpI18n }}
                </a>

                <cp-button
                  [props]="buttonData"
                  (buttonClick)="onSubmit()">
                </cp-button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <cp-modal modalId="serviceEditDeleteModal">
      <cp-service-edit-delete-modal
        [item]="deletedItem"
        (confirmed)="onDelete($event)"></cp-service-edit-delete-modal>
    </cp-modal>
  </div>
</div>