<div class="row">
  <div class="col-12">
    <cp-locations-list-top-bar
      [categories$]="categories$"
      (search)="onSearch($event)"
      (selectedCategory)="onCategorySelect($event)">
    </cp-locations-list-top-bar>
  </div>
</div>

<div [ngSwitch]="loading$ | async">
  <cp-spinner *ngSwitchCase="true"></cp-spinner>

  <div *ngSwitchCase="false">
    <cp-no-content
      class="no-content"
      *ngIf="!(locations$ | async).length"
      noContentText="No locations found...">
    </cp-no-content>

    <div *ngIf="(locations$ | async).length">
      <ul class="locations cp-form">
        <li class="cp-form__header col-12">
          <div class="row">
            <cp-sorting-header
              class="col-7"
              sortLabel="name"
              (click)="doSort('name')"
              [sortField]="state.sort_field"
              [label]="sortingLabels.locations"
              [sortDirection]="state.sort_direction">
            </cp-sorting-header>

            <span class="col-2">{{ 'locations_label_acronym' | cpI18n }}</span>
            <span class="col-2">{{ 'category' | cpI18n }}</span>
            <span class="col-1"></span>
          </div>
        </li>

        <li class="cp-form__item col-12" *ngFor="let location of locations$ | async">
          <div class="row">
            <span class="col-7 text-truncate">
              <img
                class="rounded img-fit-cover float-left avatar"
                [src]="location.image_url ? location.image_url : defaultImage">
              <strong>
                <a [routerLink]="[location.id + '/info']">
                  {{ location.name }}
                </a>
              </strong>

              <br>
              {{ location.address }}
            </span>

            <span class="col-2 text-truncate">
              {{ location.short_name }}
            </span>

            <span class="col-2 text-truncate">
              {{ location.category_name }}
            </span>

            <span>
              <a
                cpTracker
                [eventData]="eventData"
                [routerLink]="[location.id + '/edit']">
                <i class="material-icons hover action-button margin-right">edit</i>
              </a>
              <i
                (click)="deleteLocation = location;"
                data-toggle="modal" data-target="#locationsDelete"
                class="material-icons hover margin-right action-button">close</i>
            </span>
          </div>
        </li>
      </ul>

      <cp-pagination
        [pageNext]="pageNext"
        [pagePrev]="pagePrev"
        [pageNumber]="pageNumber"
        (next)="onPaginationNext()"
        (previous)="onPaginationPrevious()">
      </cp-pagination>
    </div>
  </div>
</div>

<cp-modal modalId="locationsDelete">
  <cp-locations-delete
    [location]="deleteLocation">
  </cp-locations-delete>
</cp-modal>