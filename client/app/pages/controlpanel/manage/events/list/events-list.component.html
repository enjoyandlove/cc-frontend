<div [ngSwitch]="loading">
  <cp-spinner *ngSwitchCase="true"></cp-spinner>

  <div *ngSwitchCase="false">
    <div class="cp-card actions col-xs-12">
      <div class="row">

        <cp-searchbox
          (query)="query = $event"
          class="col-xs-12 col-md-2">
        </cp-searchbox>

        <div class="col-xs-12 col-md-3">
          <div class="row">
            <div class="col-xs-9">
              <cp-dropdown
                [items]="eventFilter"
                (selected)="onFilterByEvent($event.action)">
              </cp-dropdown>
            </div>
            <div class="col-xs-3 text-left no-left-padding">
              <cp-datepicker
                class="calendar"
                [theme]="INPUT_THEME"
                [options]="dateFilterOpts">
              </cp-datepicker>
            </div>
          </div>
        </div>

        <div class="col-xs-12 col-md-5">
          <div class="row">
            <div class="col-xs-8">
              <div class="row">
                <div class="col-xs-12 col-sm-4 text-truncate text-right no-right-padding">
                  <label i18n>Filter By</label>
                </div>
                <div class="col-xs-12 col-sm-8">
                  <cp-dropdown
                    [items]="hosts"
                    (selected)="onFilterByHost($event.action)">
                  </cp-dropdown>
                </div>
              </div>
            </div>
            <div class="col-xs-4">
              <div class="col-xs-12 col-sm-9 text-truncate text-right">
                  <label i18n>Attendance</label>
                </div>
                <div class="col-xs-12 col-sm-3">
                  <cp-checkbox class="checkbox"></cp-checkbox>
                </div>
            </div>
          </div>
        </div>

        <div class="col-xs-12 col-md-2">
          <cp-button-dropdown
            class="pull-right"
            [align]="BUTTON_ALIGN"
            [data]="buttonDropdown"
            (selected)="onButtonDropdown($event.event)">
          </cp-button-dropdown>
        </div>

      </div>
    </div>

    <ul class="col-xs-12 cp-form">
      <div class="events">
        <li class="cp-form__header col-xs-12">
          <span class="col-xs-2" i18n>Name</span>
          <span class="col-xs-2" i18n>Host</span>
          <span class="col-xs-2" i18n>Date</span>
          <span class="col-xs-1" i18n>Response</span>
          <span class="col-xs-1" i18n>Attendance</span>
          <span class="col-xs-3" i18n>Rating</span>
          <span class="col-xs-1"></span>
        </li>

        <li
          class="text-center no-content col-xs-12"
          *ngIf="(events | cpFilterPipe:{ query: query ,
          filterBy: ['title', 'description' ] }).length === 0">
          <strong>No Events...</strong>
        </li>

        <li
          class="cp-form__item col-xs-12"
          *ngFor="let event of events |
          cpFilterPipe:{ query: query , filterBy: ['title', 'description' ] }">

          <span class="col-xs-12 col-md-2 text-truncate events__thumbnail">
            <img [src]="event.poster_thumb_url" class="img-rounded">
            <strong><a [routerLink]="[event.id]">{{ event.title }}</a></strong>
            <br>
            {{ event.description }}
          </span>
            <span class="col-xs-12 col-md-2 text-truncate">
            {{ event.store_name }}

          </span>
            <span class="col-xs-12 col-md-2 text-truncate">
            {{ event.start | cpDatePipe:dateFormat }}
          </span>
            <span class="col-xs-12 col-md-1 text-truncate">
            {{ event.avg_rating_percent === -1 ? '' :  event.avg_rating_percent + '%'}}
          </span>
            <span class="col-xs-12 col-md-1 text-truncate">
            {{ event.attends }}
          </span>

          <span class="col-xs-12 col-md-3 text-truncate">
            <span *ngIf="event.rating_scale_maximum > -1">
              <cp-star
                [data]="star"
                *ngFor="let star of buildStars(event)">
              </cp-star>
            </span>
          </span>

          <span
            (click)="deleteEvent = event"
            data-toggle="modal" data-target="#cpModal"
            class="col-xs-12 col-md-1 hover text-truncate delete-event">
            &times;
          </span>

        </li>
      </div>
    </ul>
  </div>
</div>

<cp-modal>
  <cp-events-delete [event]="deleteEvent"></cp-events-delete>
</cp-modal>