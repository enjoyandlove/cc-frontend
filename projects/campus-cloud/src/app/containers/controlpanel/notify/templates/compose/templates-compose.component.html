<div class="cpmodal">
  <div class="cpmodal__header">
    <div class="row">
      <div class="col-12 text-center">
        <span><strong>{{ data.name }}</strong></span>

        <button type="button"
                aria-label="close"
                data-dismiss="modal"
                (click)="resetModal()"
                class="float-right hover cpmodal__header__close unstyled-button">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    </div>
  </div>

  <div class="cpmodal__body">
    <div class="row">
      <div class="col-12">
        <form [formGroup]="form">
          <ready-ui-settings-toggle [isChecked]="state.isCampusWide"
                                    (toggle)="onHandleToggle($event)"
                                    [label]="'campus_wide' | cpI18n">
            {{ 'templates_create_label_all_students' | cpI18n }}
          </ready-ui-settings-toggle>

          <div class="form-group"
               *ngIf="!state.isCampusWide">
            <label>
              {{ 'recipient' | cpI18n }}
              <button ui-button
                      ui-tooltip
                      type="button"
                      variant="inline"
                      [template]="tooltipTpl">
                <ready-ui-icon name="help_outline"
                               size="small"></ready-ui-icon>
              </button>
            </label>
            <div class="row">
              <div class="col-12">
                <cp-typeahead [props]="typeAheadOpts"
                              (query)="onSearch($event)"
                              (selection)="onTypeAheadChange($event)"
                              (typeChange)="onSwitchSearchType($event)">
                </cp-typeahead>
              </div>
            </div>
          </div>

          <div class="form-group">
            <div class="row">
              <div class="col-6">
                <label>{{ 'announcements_type' | cpI18n }}</label>
                <div class="row">
                  <div class="col-12">
                    <cp-check-dropdown [items]="types"
                                       [reset]="resetCustomFields$"
                                       [selectedItem]="selectedType"
                                       buttonClass="cpbtn cpbtn--cancel"
                                       (selected)="onTypeChanged($event)">
                    </cp-check-dropdown>
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="row">
                  <div class="col-12">
                    <label>{{ 'from' | cpI18n }}</label>
                    <cp-dropdown [items]="stores$ | async"
                                 [reset]="resetCustomFields$"
                                 [selectedItem]="selectedHost"
                                 (selected)="onSelectedStore($event)">
                    </cp-dropdown>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="subject">
              {{ 'subject' | cpI18n }}
              <cp-char-counter class="float-right"
                               [limit]="128"
                               [charCount]="getSubjectLength()">
              </cp-char-counter>
            </label>
            <div class="cpInput subject-input">
              <div class="row">
                <div class="col-2"
                     *ngIf="subject_prefix.label">
                  <span
                        [class]="'subject-input__label text-center ' + subject_prefix.type">
                    {{ subject_prefix.label }}
                  </span>
                </div>
                <div [class]="subject_prefix.label ? 'col-10' : 'col-12'">
                  <input id="subject"
                         type="text"
                         formControlName="subject"
                         class="form-control transparent subject-input__input" />
                </div>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="message">
              {{ 'message_noun' | cpI18n }}
              <cp-char-counter class="float-right"
                               [limit]="400"
                               [charCount]="form.controls.message.value">
              </cp-char-counter>
            </label>
            <textarea id="message"
                      class="form-control"
                      formControlName="message"> </textarea>
          </div>
        </form>
      </div>
    </div>

    <div class="row"
         *ngIf="isError">
      <div class="col-12 text-center">
        <label role="alert"
               class="error">{{ errorMessage }}</label>
      </div>
    </div>
  </div>

  <div class="cpmodal__footer">
    <div class="row justify-content-end">
      <div class="col-6 text-right">
        <button type="button"
                data-dismiss="modal"
                (click)="resetModal()"
                class="cpbtn cpbtn--cancel">
          {{ 'cancel' | cpI18n }}
        </button>

        <button type="button"
                (click)="doSubmit()"
                [disabled]="!form.valid"
                class="cpbtn cpbtn--primary">
          {{ 'announce' | cpI18n }}
        </button>
      </div>
    </div>
  </div>
</div>


<ng-template #tooltipTpl>
  <div>{{ 'notify_announcement_template_to_tooltip' | cpI18n }}
    <a ui-button
       target="_blank"
       color="primary"
       variant="inline"
       [href]="tooltipLink">
      {{ 'lists_button_create' | cpI18n }}
    </a>
  </div>
</ng-template>